/* TPC_H Query 13 - Customer Distribution */
select
    c_count,
    count(*) as custdist
from
    (
        select
            c.custkey as c_custkey,
            count(o.orderkey) as c_count
        from
            customer c left outer join orders o on
                c.custkey = o.custkey
                and o.comment not like '%special%requests%'
        group by
            c.custkey
    ) as c_orders
group by
    c_count
order by
    custdist desc,
    c_count desc;

/*
Not implemented: 30
Compare
Function
Gosub
IdxGe
IdxRowid
If
IfPos
Insert
IsNull
Jump
MakeRecord
Move
NewRowid
Noop
NullRow
Once
OnceEphemeral
OpenPseudo
Return
Rowid
SCopy
Seek
SeekGe
Sequence
SorterData
SorterInsert
SorterNext
SorterOpen
SorterSort
String8

Unique opcodes: 47
AggFinal
AggStep
Close
Column
Compare
Copy
Function
Gosub
Goto
Halt
IdxGE
IdxRowid
If
IfPos
Insert
Integer
IsNull
Jump
MakeRecord
Move
NewRowid
Next
Noop
Null
NullRow
Once
OpenEphemeral
OpenPseudo
OpenRead
ResultRow
Return
Rewind
Rowid
SCopy
Seek
SeekGe
Sequence
SorterData
SorterInsert
SorterNext
SorterOpen
SorterSort
String8
TableLock
Trace
Transaction
VerifyCookie


0|Trace|0|0|0||00|
1|Integer|63|1|0||00|
2|Once|0|63|0||00|
3|OpenEphemeral|0|2|0||00|
4|Noop|0|0|0||00|
5|Integer|0|6|0||00|
6|Integer|0|5|0||00|
7|Null|0|9|9||00|
8|Gosub|8|59|0||00|
9|Goto|0|121|0||00|
10|OpenRead|1|5|0|0|00|
11|OpenRead|2|9|0|9|00|
12|OpenRead|4|22|0|keyinfo(1,BINARY)|00|
13|Rewind|1|43|0||00|
14|Integer|0|11|0||00|
15|Rowid|1|12|0||00|
16|IsNull|12|38|0||00|
17|SeekGe|4|38|12|1|00|
18|IdxGE|4|38|12|1|01|
19|IdxRowid|4|13|0||00|
20|Seek|2|13|0||00|
21|String8|0|15|0|%special%requests%|00|
22|Column|2|8|16||00|
23|Function|1|15|14|like(2)|02|
24|If|14|37|1||00|
25|Integer|1|11|0||00|
26|Rowid|1|10|0||00|
27|Compare|9|10|1|keyinfo(1,BINARY)|00|
28|Jump|29|33|29||00|
29|Move|10|9|1||00|
30|Gosub|7|50|0||00|
31|IfPos|6|63|0||00|
32|Gosub|8|59|0||00|
33|IdxRowid|4|15|0||00|
34|AggStep|0|15|3|count(1)|01|
35|Rowid|1|2|0||00|
36|Integer|1|5|0||00|
37|Next|4|18|0||00|
38|IfPos|11|42|0||00|
39|NullRow|2|0|0||00|
40|NullRow|4|0|0||00|
41|Goto|0|25|0||00|
42|Next|1|14|0||01|
43|Close|1|0|0||00|
44|Close|2|0|0||00|
45|Close|4|0|0||00|
46|Gosub|7|50|0||00|
47|Goto|0|63|0||00|
48|Integer|1|6|0||00|
49|Return|7|0|0||00|
50|IfPos|5|52|0||00|
51|Return|7|0|0||00|
52|AggFinal|3|1|0|count(1)|00|
53|SCopy|2|17|0||00|
54|SCopy|3|18|0||00|
55|MakeRecord|17|2|13||00|
56|NewRowid|0|14|0||00|
57|Insert|0|13|14||08|
58|Return|7|0|0||00|
59|Null|0|2|0||00|
60|Null|0|4|0||00|
61|Null|0|3|0||00|
62|Return|8|0|0||00|
63|Return|1|0|0||00|
64|SorterOpen|5|4|0|keyinfo(2,-BINARY,-BINARY)|00|
65|SorterOpen|6|2|0|keyinfo(1,BINARY)|00|
66|Integer|0|22|0||00|
67|Integer|0|21|0||00|
68|Null|0|25|25||00|
69|Gosub|24|107|0||00|
70|Rewind|0|76|0||00|
71|Column|0|1|27||00|
72|Sequence|6|28|0||00|
73|MakeRecord|27|2|29||00|
74|SorterInsert|6|29|0||00|
75|Next|0|71|0||01|
76|OpenPseudo|7|29|2||00|
77|SorterSort|6|110|0||00|
78|SorterData|6|29|0||00|
79|Column|7|0|26||20|
80|Compare|25|26|1|keyinfo(1,BINARY)|00|
81|Jump|82|86|82||00|
82|Move|26|25|1||00|
83|Gosub|23|94|0||00|
84|IfPos|22|110|0||00|
85|Gosub|24|107|0||00|
86|AggStep|0|0|20|count(0)|00|
87|Column|7|0|19||00|
88|Integer|1|21|0||00|
89|SorterNext|6|78|0||00|
90|Gosub|23|94|0||00|
91|Goto|0|110|0||00|
92|Integer|1|22|0||00|
93|Return|23|0|0||00|
94|IfPos|21|96|0||00|
95|Return|23|0|0||00|
96|AggFinal|20|0|0|count(0)|00|
97|Copy|19|30|0||00|
98|Copy|20|31|0||00|
99|MakeRecord|30|2|32||00|
100|SCopy|20|33|0||00|
101|SCopy|19|34|0||00|
102|Sequence|5|35|0||00|
103|Move|32|36|1||00|
104|MakeRecord|33|4|37||00|
105|SorterInsert|5|37|0||00|
106|Return|23|0|0||00|
107|Null|0|19|0||00|
108|Null|0|20|0||00|
109|Return|24|0|0||00|
110|OpenPseudo|8|32|2||00|
111|OpenPseudo|9|38|4||00|
112|SorterSort|5|119|0||00|
113|SorterData|5|38|0||00|
114|Column|9|3|32||20|
115|Column|8|0|30||20|
116|Column|8|1|31||00|
117|ResultRow|30|2|0||00|
118|SorterNext|5|113|0||00|
119|Close|8|0|0||00|
120|Halt|0|0|0||00|
121|Transaction|0|0|0||00|
122|VerifyCookie|0|27|0||00|
123|TableLock|0|5|0|Customer|00|
124|TableLock|0|9|0|Orders|00|
125|Goto|0|10|0||00|
*/