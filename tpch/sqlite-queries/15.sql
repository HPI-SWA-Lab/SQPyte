/* TPC_H Query 15 - Top Supplier */
create view revenue as
	select
		suppkey as supplier_no,
		sum(extendedprice * (1 - discount)) as totarevenue
	from
		lineitem
	where
		shipdate >= date('1995-01-01')
		and shipdate < date('1995-01-01', '+3 month')
	group by
		suppkey;

select
	suppkey,
	name,
	address,
	phone,
	totarevenue
from
	supplier,
	revenue
where
	suppkey = supplier_no
	and totarevenue = (
		select
			max(totarevenue)
		from
			revenue
	)
order by
	suppkey;

drop view revenue;

/*
Total not implemented: 37
CollSeq
Compare
Delete
DropTable
Function
Gosub
IdxRowid
If
IfPos
IfZero
Insert
Jump
MakeRecord
Move
Multiply
NewRowid
Noop
NotNull
Once
OnceEphemeral
OpenPseudo
ParseSchema
RealAffinity
Return
RowSetAdd
RowSetRead
Rowid
SCopy
Seek
Sequence
SorterData
SorterInsert
SorterNext
SorterOpen
SorterSort
String8
Subtract

CREATE VIEW: 8
If
Insert
MakeRecord
NewRowid
NotNull
ParseSchema
Rowid
String8

SELECT: 30
CollSeq
Compare
Function
Gosub
IdxRowid
IfPos
IfZero
Insert
Jump
MakeRecord
Move
Multiply
NewRowid
Noop
Once
OnceEphemeral
OpenPseudo
RealAffinity
Return
Rowid
SCopy
Seek
Sequence
SorterData
SorterInsert
SorterNext
SorterOpen
SorterSort
String8
Subtract

DROP VIEW: 6
Delete
DropTable
RowSetAdd
RowSetRead
Rowid
String8


Total unique opcodes: 63
AggFinal
AggStep
Close
CollSeq
Column
Compare
Copy
Delete
DropTable
Eq
Function
Ge
Gosub
Goto
Halt
IdxRowid
If
IfPos
IfZero
Insert
Integer
Jump
Lt
MakeRecord
Move
Multiply
MustBeInt
Ne
NewRowid
Next
Noop
NotExists
NotNull
Null
Once
OpenEphemeral
OpenPseudo
OpenRead
OpenWrite
ParseSchema
ReadCookie
RealAffinity
ResultRow
Return
Rewind
RowSetAdd
RowSetRead
Rowid
SCopy
Seek
Sequence
SetCookie
SorterData
SorterInsert
SorterNext
SorterOpen
SorterSort
String8
Subtract
TableLock
Trace
Transaction
VerifyCookie

CREATE VIEW: 23
Close
Copy
Goto
Halt
If
Insert
Integer
MakeRecord
MustBeInt
NewRowid
NotExists
NotNull
Null
OpenWrite
ParseSchema
ReadCookie
Rowid
SetCookie
String8
TableLock
Trace
Transaction
VerifyCookie

SELECT: 51
AggFinal
AggStep
Close
CollSeq
Column
Compare
Function
Ge
Gosub
Goto
Halt
IdxRowid
IfPos
IfZero
Insert
Integer
Jump
Lt
MakeRecord
Move
Multiply
MustBeInt
Ne
NewRowid
Next
Noop
NotExists
Null
Once
OpenEphemeral
OpenPseudo
OpenRead
RealAffinity
ResultRow
Return
Rewind
Rowid
SCopy
Seek
Sequence
SorterData
SorterInsert
SorterNext
SorterOpen
SorterSort
String8
Subtract
TableLock
Trace
Transaction
VerifyCookie

DROP VIEW: 24
Close
Column
Delete
DropTable
Eq
Goto
Halt
Integer
Ne
Next
NotExists
Null
OpenRead
OpenWrite
Rewind
RowSetAdd
RowSetRead
Rowid
SetCookie
String8
TableLock
Trace
Transaction
VerifyCookie


CREATE VIEW:
0|Trace|0|0|0||00|
1|Goto|0|38|0||00|
2|ReadCookie|0|3|2||00|
3|If|3|8|0||00|
4|Integer|4|3|0||00|
5|SetCookie|0|2|3||00|
6|Integer|1|3|0||00|
7|SetCookie|0|5|3||00|
8|Integer|0|2|0||00|
9|OpenWrite|0|1|0|5|00|
10|NewRowid|0|1|0||00|
11|Null|0|3|0||00|
12|Insert|0|3|1||08|
13|Close|0|0|0||00|
14|Close|0|0|0||00|
15|Null|0|4|5||00|
16|OpenWrite|1|1|0|5|00|
17|MustBeInt|1|20|0||00|
18|NotExists|1|20|1||00|
19|Rowid|1|5|0||00|
20|NotNull|5|22|0||00|
21|Goto|0|33|0||00|
22|NotExists|1|21|5||00|
23|Null|0|6|10||00|
24|String8|0|6|0|view|00|
25|String8|0|7|0|revenue|00|
26|String8|0|8|0|revenue|00|
27|Copy|2|9|0||00|
28|String8|0|10|0|CREATE VIEW revenue as
select
suppkey as supplier_no,
sum(extendedprice * (1 - discount)) as totarevenue
from
lineitem
where
shipdate >= date('1995-01-01')
and shipdate < date('1995-01-01', '+3 month')
group by
suppkey|00|
29|NotExists|1|30|5||00|
30|MakeRecord|6|5|11|aaada|00|
31|Insert|1|11|5||00|
32|Goto|0|21|0||00|
33|Close|1|0|0||00|
34|Integer|28|12|0||00|
35|SetCookie|0|1|12||00|
36|ParseSchema|0|0|0|tbl_name='revenue'|00|
37|Halt|0|0|0||00|
38|Transaction|0|1|0||00|
39|VerifyCookie|0|27|0||00|
40|TableLock|0|1|1|sqlite_master|00|
41|Goto|0|2|0||00|

SELECT:
0|Trace|0|0|0||00|
1|Integer|61|1|0||00|
2|Once|0|61|0||00|
3|OpenEphemeral|1|2|0||00|
4|Noop|0|0|0||00|
5|Integer|0|7|0||00|
6|Integer|0|6|0||00|
7|Null|0|10|10||00|
8|Gosub|9|56|0||00|
9|Goto|0|171|0||00|
10|OpenRead|2|8|0|11|00|
11|OpenRead|6|21|0|keyinfo(1,BINARY)|00|
12|Rewind|6|41|12|0|00|
13|IdxRowid|6|12|0||00|
14|Seek|2|12|0||00|
15|Column|2|10|13||00|
16|String8|0|15|0|1995-01-01|00|
17|Function|1|15|14|date(-1)|01|
18|Lt|14|40|13|collseq(BINARY)|6a|
19|String8|0|16|0|1995-01-01|00|
20|String8|0|17|0|+3 month|00|
21|Function|3|16|14|date(-1)|02|
22|Ge|14|40|13|collseq(BINARY)|6a|
23|Column|6|0|11||00|
24|Compare|10|11|1|keyinfo(1,BINARY)|00|
25|Jump|26|30|26||00|
26|Move|11|10|1||00|
27|Gosub|8|47|0||00|
28|IfPos|7|61|0||00|
29|Gosub|9|56|0||00|
30|Column|2|5|12||00|
31|RealAffinity|12|0|0||00|
32|Integer|1|18|0||00|
33|Column|2|6|19||00|
34|RealAffinity|19|0|0||00|
35|Subtract|19|18|14||00|
36|Multiply|14|12|16||00|
37|AggStep|0|16|3|sum(1)|01|
38|Column|6|0|2||00|
39|Integer|1|6|0||00|
40|Next|6|13|0||00|
41|Close|2|0|0||00|
42|Close|6|0|0||00|
43|Gosub|8|47|0||00|
44|Goto|0|61|0||00|
45|Integer|1|7|0||00|
46|Return|8|0|0||00|
47|IfPos|6|49|0||00|
48|Return|8|0|0||00|
49|AggFinal|3|1|0|sum(1)|00|
50|SCopy|2|20|0||00|
51|SCopy|3|21|0||00|
52|MakeRecord|20|2|19||00|
53|NewRowid|1|12|0||00|
54|Insert|1|19|12||08|
55|Return|8|0|0||00|
56|Null|0|2|0||00|
57|Null|0|4|0||00|
58|Null|0|5|0||00|
59|Null|0|3|0||00|
60|Return|9|0|0||00|
61|Return|1|0|0||00|
62|SorterOpen|7|3|0|keyinfo(1,BINARY)|00|
63|OpenRead|0|3|0|5|00|
64|Rewind|1|156|0||00|
65|Column|1|1|22||00|
66|Once|1|140|0||00|
67|Null|0|24|0||00|
68|Integer|127|25|0||00|
69|Once|2|127|0||00|
70|OpenEphemeral|3|2|0||00|
71|Noop|0|0|0||00|
72|Integer|0|31|0||00|
73|Integer|0|30|0||00|
74|Null|0|34|34||00|
75|Gosub|33|122|0||00|
76|OpenRead|4|8|0|11|00|
77|OpenRead|9|21|0|keyinfo(1,BINARY)|00|
78|Rewind|9|107|36|0|00|
79|IdxRowid|9|36|0||00|
80|Seek|4|36|0||00|
81|Column|4|10|37||00|
82|String8|0|39|0|1995-01-01|00|
83|Function|1|39|38|date(-1)|01|
84|Lt|38|106|37|collseq(BINARY)|6a|
85|String8|0|40|0|1995-01-01|00|
86|String8|0|41|0|+3 month|00|
87|Function|3|40|38|date(-1)|02|
88|Ge|38|106|37|collseq(BINARY)|6a|
89|Column|9|0|35||00|
90|Compare|34|35|1|keyinfo(1,BINARY)|00|
91|Jump|92|96|92||00|
92|Move|35|34|1||00|
93|Gosub|32|113|0||00|
94|IfPos|31|127|0||00|
95|Gosub|33|122|0||00|
96|Column|4|5|36||00|
97|RealAffinity|36|0|0||00|
98|Integer|1|42|0||00|
99|Column|4|6|43||00|
100|RealAffinity|43|0|0||00|
101|Subtract|43|42|38||00|
102|Multiply|38|36|40||00|
103|AggStep|0|40|27|sum(1)|01|
104|Column|9|0|26||00|
105|Integer|1|30|0||00|
106|Next|9|79|0||00|
107|Close|4|0|0||00|
108|Close|9|0|0||00|
109|Gosub|32|113|0||00|
110|Goto|0|127|0||00|
111|Integer|1|31|0||00|
112|Return|32|0|0||00|
113|IfPos|30|115|0||00|
114|Return|32|0|0||00|
115|AggFinal|27|1|0|sum(1)|00|
116|SCopy|26|44|0||00|
117|SCopy|27|45|0||00|
118|MakeRecord|44|2|43||00|
119|NewRowid|3|36|0||00|
120|Insert|3|43|36||08|
121|Return|32|0|0||00|
122|Null|0|26|0||00|
123|Null|0|28|0||00|
124|Null|0|29|0||00|
125|Null|0|27|0||00|
126|Return|33|0|0||00|
127|Return|25|0|0||00|
128|Integer|1|46|0||00|
129|Null|0|48|0||00|
130|Null|0|47|0||00|
131|Rewind|3|136|0||00|
132|Column|3|1|49||00|
133|CollSeq|0|0|0|collseq(BINARY)|00|
134|AggStep|0|49|47|max(1)|01|
135|Next|3|132|0||01|
136|AggFinal|47|1|0|max(1)|00|
137|SCopy|47|50|0||00|
138|Move|50|24|1||00|
139|IfZero|46|140|-1||00|
140|Ne|24|155|22|collseq(BINARY)|6a|
141|Column|1|0|22||00|
142|MustBeInt|22|155|0||00|
143|NotExists|0|155|22||00|
144|Rowid|0|51|0||00|
145|Column|0|1|52||00|
146|Column|0|2|53||00|
147|Column|0|4|54||00|
148|Column|1|1|55||00|
149|MakeRecord|51|5|22||00|
150|Rowid|0|56|0||00|
151|Sequence|7|57|0||00|
152|Move|22|58|1||00|
153|MakeRecord|56|3|23||00|
154|SorterInsert|7|23|0||00|
155|Next|1|65|0||01|
156|Close|0|0|0||00|
157|OpenPseudo|10|22|5||00|
158|OpenPseudo|11|59|3||00|
159|SorterSort|7|169|0||00|
160|SorterData|7|59|0||00|
161|Column|11|2|22||20|
162|Column|10|0|51||20|
163|Column|10|1|52||00|
164|Column|10|2|53||00|
165|Column|10|3|54||00|
166|Column|10|4|55||00|
167|ResultRow|51|5|0||00|
168|SorterNext|7|160|0||00|
169|Close|10|0|0||00|
170|Halt|0|0|0||00|
171|Transaction|0|0|0||00|
172|VerifyCookie|0|28|0||00|
173|TableLock|0|8|0|LineItem|00|
174|TableLock|0|3|0|Supplier|00|
175|Goto|0|10|0||00|

DROP VIEW:
0|Trace|0|0|0||00|
1|Goto|0|25|0||00|
2|Null|0|1|0||00|
3|OpenRead|0|1|0|3|00|
4|Rewind|0|14|0||00|
5|Column|0|2|3||00|
6|String8|0|4|0|revenue|00|
7|Ne|4|13|3|collseq(BINARY)|69|
8|Column|0|0|4||00|
9|String8|0|5|0|trigger|00|
10|Eq|5|13|4|collseq(BINARY)|69|
11|Rowid|0|2|0||00|
12|RowSetAdd|1|2|0||00|
13|Next|0|5|0||01|
14|Close|0|0|0||00|
15|OpenWrite|0|1|0|5|00|
16|RowSetRead|1|20|2||00|
17|NotExists|0|19|2||00|
18|Delete|0|0|0||00|
19|Goto|0|16|0||00|
20|Close|0|0|0||00|
21|DropTable|0|0|0|revenue|00|
22|Integer|29|4|0||00|
23|SetCookie|0|1|4||00|
24|Halt|0|0|0||00|
25|Transaction|0|1|0||00|
26|VerifyCookie|0|28|0||00|
27|TableLock|0|1|1|sqlite_master|00|
28|Goto|0|2|0||00|
*/